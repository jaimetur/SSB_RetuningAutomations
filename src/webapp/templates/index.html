<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Frontend Web - SSB Retuning</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <!-- Main dashboard -->
  <main class="container">
    <header class="topbar">
      <div>
        <h1>SSB Retuning - Frontend Web</h1>
        <p>User: <b>{{ user.username }}</b> ({{ user.role }})</p>
      </div>
      <nav>
        {% if user.role == 'admin' %}<a href="/admin">Admin panel</a>{% endif %}
        <a href="/logout">Sign out</a>
      </nav>
    </header>

    <section class="card">
      <h2>Run module</h2>
      <form action="/run" method="post" class="grid">
        <label>Module
          <select name="module" required>
            {% for value, label in module_options %}
              <option value="{{ value }}" {% if settings.get('module') == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </label>

        <label>Input
          <input type="text" name="input" value="{{ settings.get('input', '') }}" placeholder="/ruta/input" />
        </label>
        <label>Input PRE
          <input type="text" name="input_pre" value="{{ settings.get('input_pre', '') }}" />
        </label>
        <label>Input POST
          <input type="text" name="input_post" value="{{ settings.get('input_post', '') }}" />
        </label>

        <label>N77 SSB PRE
          <input type="text" name="n77_ssb_pre" value="{{ settings.get('n77_ssb_pre', '') }}" />
        </label>
        <label>N77 SSB POST
          <input type="text" name="n77_ssb_post" value="{{ settings.get('n77_ssb_post', '') }}" />
        </label>
        <label>N77B SSB
          <input type="text" name="n77b_ssb" value="{{ settings.get('n77b_ssb', '') }}" />
        </label>

        <label>Allowed N77 SSB PRE
          <input type="text" name="allowed_n77_ssb_pre" value="{{ settings.get('allowed_n77_ssb_pre', '') }}" />
        </label>
        <label>Allowed N77 ARFCN PRE
          <input type="text" name="allowed_n77_arfcn_pre" value="{{ settings.get('allowed_n77_arfcn_pre', '') }}" />
        </label>
        <label>Allowed N77 SSB POST
          <input type="text" name="allowed_n77_ssb_post" value="{{ settings.get('allowed_n77_ssb_post', '') }}" />
        </label>
        <label>Allowed N77 ARFCN POST
          <input type="text" name="allowed_n77_arfcn_post" value="{{ settings.get('allowed_n77_arfcn_post', '') }}" />
        </label>

        <label>CA Freq Filters
          <input type="text" name="ca_freq_filters" value="{{ settings.get('ca_freq_filters', '') }}" />
        </label>
        <label>CC Freq Filters
          <input type="text" name="cc_freq_filters" value="{{ settings.get('cc_freq_filters', '') }}" />
        </label>

        <label><input type="checkbox" name="profiles_audit" {% if settings.get('profiles_audit') %}checked{% endif %}> Profiles Audit</label>
        <label><input type="checkbox" name="frequency_audit" {% if settings.get('frequency_audit') %}checked{% endif %}> Frequency Audit</label>
        <label><input type="checkbox" name="export_correction_cmd" {% if settings.get('export_correction_cmd') %}checked{% endif %}> Export Correction Cmd</label>
        <label><input type="checkbox" name="fast_excel_export" {% if settings.get('fast_excel_export') %}checked{% endif %}> Fast Excel Export</label>

        <button type="submit">Run</button>
      </form>
    </section>

    <section class="card">
      <h2>Latest runs</h2>
      <table>
        <thead><tr><th>Module</th><th>Status</th><th>Start</th><th>End</th><th>Duration (s)</th></tr></thead>
        <tbody>
        {% for r in latest_runs %}
          <tr>
            <td>{{ r.module }}</td>
            <td>{{ r.status }}</td>
            <td>{{ r.started_at }}</td>
            <td>{{ r.finished_at }}</td>
            <td>{{ '%.2f'|format(r.duration_seconds or 0) }}</td>
          </tr>
        {% else %}
          <tr><td colspan="5">No runs yet.</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </section>
  </main>
</body>
</html>
